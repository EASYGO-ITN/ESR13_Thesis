import numpy as np
import matplotlib.pyplot as plt
import tikzplotlib
from SP2009 import SpycherPruss2009
import CoolProp as cp

pdata = [1, 1.30543816, 1.70416878, 2.22468695, 2.90419122, 3.79124203, 4.949232, 6.4609163, 8.43432665, 11.0104918, 14.3735161, 18.7637364, 24.4948974, 31.9765737, 41.7434394, 54.4934785, 71.1378661, 92.8660847, 121.23093, 158.259482, 206.597966, 269.700868, 352.077804, 459.615798, 600]

ydata = {
# 20: [2.374965, 1.8281705, 1.4072878, 1.0846833, 0.837917192, 0.648438003, 0.503741, 0.393105409, 0.308598846, 0.244286038, 0.195482624, 0.158908624, 0.132105563, 0.113537055, 0.103363385, 0.106460699, 0.119687471, 0.098315766, 0.0788553269, 0.0628331944, 0.0501022185, 0.0402008712, 0.0326446002, 0.0270019568, 0.0229339065],
# 31: [4.56242836, np.NaN, np.NaN, 2.07695539, 1.60414655, 1.24099702, 0.963145224, 0.750179305, 0.587699735, 0.46380696, 0.369712314, 0.298891854, 0.246245076, 0.208844927, 0.185332844, 0.178617933, 0.22915693, 0.195733058, 0.157519688, 0.12570903, 0.100344917, 0.0805688711, 0.0654065903, 0.0540833256, 0.0458588155],
# 60: [20.1228164, 15.4562155, 11.8817073, 9.14356853, 7.04649504, 5.4406036, 4.21089676, 3.26969432, 2.54992103, 1.99997707, 1.58077443, 1.26221905, 1.02285888, 0.845616291, 0.719791172, 0.640757858, 0.615639057, 0.69787673, 1.08529157, np.NaN, 1.71470438, 1.91221243, 2.06659231, 2.18042516, 2.25115307],
# 99: [70.954846, 70.954846, 57.6740614, 44.3399972, 34.1246817, 26.3000313, 20.3064581, 15.7174123, 12.2041264, 9.51709799, 7.46401949, 5.89813644, 4.70897322, 3.81177039, 3.14536126, 2.66860315, 2.35623481, 2.21317568, 2.29696665, 2.71020971, 3.31013887, 3.82487352, 4.21458435, 4.48910758, 4.65447416],
# 150: [70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 57.4685944, 44.6130226, 34.7704861, 27.2439819, 21.4994856, 17.129685, 13.8251157, 11.3571292, 9.56115294, 8.33221091, 7.62642032, 7.47345952, 7.90574069, 8.71961596, 9.52040035, 10.1109345, 10.4500563],
# 200: [70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 65.8216926, 51.9958435, 41.4612241, 33.4860843, 27.5209523, 23.1688856, 20.1707375, 18.388415, 17.7905038, 18.2607313, 19.2711986, 20.1767159, 20.6843339],
# 250: [70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 70.954846, 62.2967067, 51.4787532, 43.6320982, 38.3318967, 49.8830958, 34.6838887, 35.6405723, 36.8664655, 37.4700856],
250: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 76.7984284, 62.3061543, 51.4784731, 43.63366, 38.3348659, 35.3797986, 34.68412, 35.6423097, 36.8649336, 37.4712302],
200: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 83.9000243, 65.8213751, 51.9947908, 41.4614556, 33.48904, 27.524002, 23.1713889, 20.1725313, 18.3888823, 17.7916596, 18.2592387, 19.2682148, 20.1780966, 20.6859035],
150: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 74.2482788, 57.4692029, 44.6134907, 34.7727646, 27.2455532, 21.5018428, 17.1348321, 13.8261116, 11.3589038, 9.5627172, 8.33124835, 7.62602411, 7.47430133, 7.90621816, 8.72002513, 9.51917344, 10.1091906, 10.451141],
99: [np.NaN, 75.0774333, 57.6743116, 44.3396329, 34.1244948, 26.2996104, 20.3054286, 15.71746, 12.2044791, 9.51744011, 7.46373554, 5.89802023, 4.70864877, 3.81234196, 3.1459413, 2.66848699, 2.3562028, 2.2140027, 2.29697691, 2.70948901, 3.30966709, 3.82468614, 4.2137009, 4.488278, 4.6553549],
60: [20.1218616, 15.4556028, 11.8814474, 9.1436424, 7.04657104, 5.44062675, 4.21092417, 3.26976322, 2.54994356, 2.00002175, 1.58078533, 1.26252113, 1.02290536, 0.845604916, 0.719814474, 0.640780576, 0.616115247, 0.697989773, 1.0852623, 1.45801127, 1.71473199, 1.91194013, 2.06630463, 2.18004756, 2.25097997],
31: [4.56234095, 3.5065469, 2.69781338, 2.07839741, 1.60403408, 1.24082531, 0.962817969, 0.750163637, 0.587702044, 0.463803306, 0.369695335, 0.298775015, 0.246215205, 0.208880925, 0.185294769, 0.178621908, 0.229108887, 0.195699226, 0.157508577, 0.125762562, 0.100387976, 0.0805893448, 0.0654485219, 0.0540875656, 0.0458457638],
20: [2.37790553, 1.82811645, 1.40700803, 1.08448625, 0.837502255, 0.648405269, 0.503694336, 0.393105375, 0.308610612, 0.244251419, 0.195480671, 0.158875684, 0.132050477, 0.113612919, 0.103343085, 0.106454451, 0.119686933, 0.0983175743, 0.0789271052, 0.0628608871, 0.0501321653, 0.0402180678, 0.0326626227, 0.0270086968, 0.022941007],
}

xdata = {
# 20: [0.0695704903, 0.0909539568, 0.118714478, 0.1546018, 0.200855297, 0.26036014, 0.336381294, 0.43296513, 0.554650955, 0.706378706, 0.893039838, 1.1183229, 1.38361304, 1.68569996, 2.01067187, 2.32855893, 2.73616601, 3.35032449, 4.0531454, 4.8280077, 5.64654678, 6.46322844, 7.21382779, 7.81352807, 8.15721363],
# 31: [0.0505093891, np.NaN, np.NaN, 0.114058074, 0.148738539, 0.19350795, 0.250987892, 0.324557332, 0.417969718, 0.535633865, 0.682137828, 0.861782993, 1.07789266, 1.32997881, 1.61175539, 1.90485623, 2.16240953, 2.66826282, 3.27333408, 3.95968056, 4.70543714, 5.4700226, 6.18854345, 6.77055151, 7.1038045],
# 60: [0.0234486336, 0.032310626, 0.0438579973, 0.0588518002, 0.0782990672, 0.103503542, 0.13605456, 0.177960985, 0.231776143, 0.300395107, 0.387380739, 0.496228409, 0.630928503, 0.794355235, 0.987275596, 1.20542061, 1.43563549, 1.6501232, 1.79966392, np.NaN, np.NaN, 2.07937558, 2.16701112, 2.25145377, 2.32726521],
# 99: [np.NaN, np.NaN, 0.0133458455, 0.0228321889, 0.0351575153, 0.0511602898, 0.0718893672, 0.0987007058, 0.133310205, 0.177760216, 0.234575758, 0.306662637, 0.397328834, 0.51013131, 0.647623073, 0.81107088, 0.997592041, 1.19850717, 1.39543904, 1.56316265, 1.69354748, 1.79835069, 1.88483261, 1.95086509, 1.98899122],
# 150: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 0.0521075922, 0.0880103781, 0.134224722, 0.193388736, 0.268827687, 0.363831361, 0.482404714, 0.627824566, 0.801597087, 1.00176085, 1.2199365, 1.43770456, 1.63023025, 1.77930719, 1.87819436, 1.92229749, 1.90208288],
# 200: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 0.122726399, 0.222242176, 0.348181987, 0.505575404, 0.698915355, 0.929271121, 1.19198841, 1.47096354, 1.73304208, 1.93409034, 2.03606593, 2.020865, 1.88514254],
# 250: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 0.449046391, 0.745248687, 1.10983334, 1.53965997, 2.00900373, 2.43529136, 2.71012493, 2.73794686, 2.50639437],
250: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 0.213602393, 0.448842376, 0.745290452, 1.10965743, 1.53991563, 2.0063757, 2.43524648, 2.7095663, 2.73751778, 2.50691772],
200: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 0.0447417211, 0.122706488, 0.222245297, 0.348161283, 0.50552179, 0.698684619, 0.929256961, 1.19228276, 1.47120876, 1.73330509, 1.9338488, 2.03575831, 2.02129437, 1.88524523],
150: [np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, np.NaN, 0.0243098532, 0.0521000416, 0.0880011224, 0.1341864, 0.193361602, 0.268699338, 0.363696699, 0.482417002, 0.627742314, 0.801559517, 1.00198535, 1.21983707, 1.43789752, 1.63024709, 1.77918024, 1.87800835, 1.92192679, 1.90224267],
99: [np.NaN, 0.0060493967, 0.013347286, 0.0228321992, 0.0351636858, 0.0511549794, 0.071883732, 0.0987231506, 0.133278569, 0.177671153, 0.23454185, 0.306668642, 0.39740976, 0.510085645, 0.64762426, 0.810901049, 0.997540267, 1.19879819, 1.39544009, 1.56318506, 1.69347999, 1.79830562, 1.88408078, 1.95028623, 1.98935022],
60: [0.0234478746, 0.0323227308, 0.0438655753, 0.0588453738, 0.0782878596, 0.103465847, 0.13601389, 0.177911395, 0.231739678, 0.300326713, 0.387381199, 0.496275111, 0.631015627, 0.794244727, 0.987258201, 1.20529824, 1.43622926, 1.64935318, 1.79973624, 1.90027842, 1.99100204, 2.07940795, 2.16708189, 2.25147009, 2.32727064],
31: [0.0504832048, 0.0664544837, 0.087171495, 0.114018717, 0.148734811, 0.193497996, 0.250999288, 0.324513614, 0.41797484, 0.535615234, 0.682118221, 0.861834023, 1.07774696, 1.3300831, 1.61167415, 1.90484524, 2.16261568, 2.66833533, 3.27336683, 3.95971157, 4.70596578, 5.46982679, 6.18837023, 6.77106047, 7.10473765],
20: [0.0695278598, 0.0909530598, 0.118715692, 0.154612308, 0.200894242, 0.260344775, 0.336351852, 0.432985886, 0.554713719, 0.70648159, 0.89314025, 1.11816442, 1.38335802, 1.68539327, 2.01101376, 2.32864355, 2.73628764, 3.35017968, 4.05218189, 4.82786712, 5.64549415, 6.46301683, 7.21384495, 7.81368413, 8.15739397],

}

colors = {250:"#1f77b4", 200:"#ff7f0e", 150:"#2ca02c", 99:"#d62728", 60: "#9467bd",31: "#8c564b", 20: "#e377c2"}
ps = [1, 2,3,4,5,6, 7,8, 9,10,11, 13, 15, 17, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 54, 57, 60 , 63, 66, 69, 72, 75, 80, 85, 90, 95, 100, 125, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600]
mixture = cp.AbstractState("?", "Water&CarbonDioxide")


fig1, ax1 = plt.subplots()
ax1.plot([-1,-1],[1000,1000], "k--", label="Aspen Plus v11")
ax1.plot([-1,-1],[1000,1000], "k", label="SP2009")
for t in ydata:
    label = "\\qty{" + str(t) + "}{" + "\\degreeCelsius}"
    yH = [SpycherPruss2009().calc_yH2O(p*1e5, t+273.15) for p in ps]
    ax1.plot(ps, yH, color=colors[t], label=label)

for t in ydata:
    ax1.plot(pdata, ydata[t], color=colors[t], linestyle="--")

ax1.set_xlabel("Pressure/\\unit{\\bar}")
ax1.set_ylabel("\\(y_{H_2O}\\)/\\unit{\\percent}")
ax1.set_yscale("log")
ax1.set_xlim((0, 600))
ax1.legend()
# plt.show()




fig2, ax2 = plt.subplots()
ax2.plot([-1,-1],[1000,1000], "k--", label="Aspen Plus v11")
ax2.plot([-1,-1],[1000,1000], "k", label="SP2009")

for t in xdata:
    label = "\\qty{" + str(t) + "}{" + "\\degreeCelsius}"

    if t <= 99:
        xC = [SpycherPruss2009().calc_xCO2(p*1e5, t+273.15) for p in ps]
        ax2.plot(ps, xC, color=colors[t], label=label)

for t in xdata:

    if t <= 99:
        xC = [SpycherPruss2009().calc_xCO2(p*1e5, t+273.15) for p in ps]
        ax2.plot(pdata, xdata[t], color=colors[t], linestyle="--")

ax2.set_xlabel("Pressure/\\unit{\\bar}")
ax2.set_ylabel("\\(x_{CO_2}\\)/\\unit{\\percent}")
ax2.set_ylim((0, 10))
ax2.set_xlim((0, 600))
ax2.legend()



fig3, ax3 = plt.subplots()
ax3.plot([-1,-1],[1000,1000], "k--", label="Aspen Plus v11")
ax3.plot([-1,-1],[1000,1000], "k", label="SP2009")
for t in xdata:
    label = "\\qty{" + str(t) + "}{" + "\\degreeCelsius}"

    if t>99:
        xC = [SpycherPruss2009().calc_xCO2(p * 1e5, t + 273.15) for p in ps]
        ax3.plot(ps, xC, color=colors[t], label=label)
    elif t==99:
        xC = [SpycherPruss2009().calc_xCO2(p*1e5, t+273.15) for p in ps]
        ax3.plot(ps, xC, color=colors[t], label=label)

for t in xdata:

    if t>99:
        xC = [SpycherPruss2009().calc_xCO2(p * 1e5, t + 273.15) for p in ps]
        ax3.plot(pdata, xdata[t], color=colors[t], linestyle="--")
    elif t==99:
        xC = [SpycherPruss2009().calc_xCO2(p*1e5, t+273.15) for p in ps]
        ax3.plot(pdata, xdata[t], color=colors[t], linestyle="--")

ax3.set_xlabel("Pressure/\\unit{\\bar}")
ax3.set_ylabel("\\(x_{CO_2}\\)/\\unit{\\percent}")
ax3.set_ylim((0, 10))
ax3.set_xlim((0, 600))
ax3.legend()



# calculate the percentage error
fig1a, ax1a = plt.subplots()
for t in ydata:
    label = "\\qty{" + str(t) + "}{" + "\\degreeCelsius}"

    yH = np.array([SpycherPruss2009().calc_yH2O(p*1e5, t+273.15) for p in pdata])
    yH_as = np.array(ydata[t])
    # diff = (np.abs(yH - yH_as))/yH
    diff = yH_as/yH

    ax1a.plot(pdata, diff, color=colors[t], label=label)

ax1a.set_yscale("log")
ax1a.set_xlabel("Pressure/\\unit{\\bar}")
ax1a.set_ylabel("\\(\\frac{y_{H_2O}^{Aspen}}{y_{H_2O}^{SP2009}}\\)")
ax1a.set_xlim((0, 600))
ax1a.legend()



# calculate the percentage error
fig2a, ax2a = plt.subplots()
for t in ydata:
    label = "\\qty{" + str(t) + "}{" + "\\degreeCelsius}"

    xC = np.array([SpycherPruss2009().calc_xCO2(p*1e5, t+273.15) for p in pdata])
    xC_as = np.array(xdata[t])
    # diff = (np.abs(xC - xC_as))/xC
    diff = xC_as/xC

    ax2a.plot(pdata, diff, color=colors[t], label=label)

# ax2a.set_yscale("log")
ax2a.set_xlabel("Pressure/\\unit{\\bar}")
ax2a.set_ylabel("\\(\\frac{x_{CO_2}^{Aspen}}{x_{CO_2}^{SP2009}}\\)")
ax2a.set_xlim((0, 600))
ax2a.legend()



# tikzplotlib.save("SP2009vsAspen_yH2O.tex", figure=fig1)
# tikzplotlib.save("SP2009vsAspen_xCO2_part1.tex", figure=fig2)
# tikzplotlib.save("SP2009vsAspen_xCO2_part2.tex", figure=fig3)
# tikzplotlib.save("SP2009vsAspen_yH2O_ratio.tex", figure=fig1a)
# tikzplotlib.save("SP2009vsAspen_xCO2_ratio.tex", figure=fig2a)


plt.show()
